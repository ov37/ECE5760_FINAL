<!DOCTYPE HTML>
<!--
	Hyperspace by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Bolero Surround Sound</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Sidebar -->
			<section id="sidebar">
				<div class="inner">
					<nav>
						<ul>
							<li><a href="#intro">Welcome</a></li>
							<li><a href="#introduction">Introduction</a></li>
							<li><a href="#high">High Level Design</a></li>
							<li><a href="#hdesign">Hardware Design</a></li>
							<li><a href="#one">Who we are</a></li>
							<li><a href="#two">What we do</a></li>
							<li><a href="#three">Get in touch</a></li>
						</ul>
					</nav>
				</div>
			</section>

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Intro -->
					<section id="intro" class="wrapper style1 fullscreen fade-up">
						<div class="inner">
							<h1>Bolero Surround Sound</h1>
							<p>A project that allows a user to listen to synthesized instruments located in different places around a room. </p>
							<ul class="actions">
								<li><a href="#introduction" class="button scrolly">Learn more</a></li>
							</ul>
						</div>
					</section>

				<!-- Introduction -->
					<section id="introduction" class="wrapper style3 fade-up">
						<div class="inner">
							<h2>Introduction</h2>
							<p>Maurice Ravel’s Bolero is a piece where many instruments carry and pass along the same melodic line. This project aims to recreate the experience of standing in a room of musicians playing a snippet of this iconic work. Five different instrument sounds are synthesized to play the score’s three most common parts. A user has the ability to change the location of the instruments and hear their parts come from different directions. A VGA draws the instruments at their various locations, and updates as the user moves the instruments around. </p>
						</div>
					</section>
				
				
				<!-- High -->
					<section id="high" class="wrapper style2 spotlights">
						<section>
							<div class="content">
								<div class="inner">
									<h2>High Level Design</h2>
									<h3>This project was broken down into three main parts: music synthesis, sound spatialization, and a user interface.</h3>
								</div>
							</div>
						</section>
						<section>
							<div class="content">
								<div class="inner">
									<h3>Sound Synthesis</h3>
									<p>To synthesize various instruments, the Karplus-Strong Algorithm was used (see Figure #). The Karplus-Strong Algorithm is a digital waveguide synthesis algorithm that can model a string using a drive function, delay line, and filter. The drive function provides the initial positions for every node on a string. Once the string’s nodes are “released,” the feedback delay line creates the string’s oscillations. The length of the delay line determines the frequency of the oscillations. The lossy filter recreates the string’s damping. A delay line with more loss will cause the oscillations to decay at a faster rate than a delay line with less loss.</p>
								</div>
							</div>
						</section>
						<section>
							<div class="content">
								<div class="inner">
									<h3>Sound Spatialization</h3>
									<p>To manipulate the sound so it had a directional component, we used the Center for Image Processing and Integrated Computing (CIPIC) Head Related Transfer Function (HRTF) Database from the University of California - Davis. Each instrument’s single mono channel is fed into a linear FIR filter module which uses the coefficients from the CIPIC HRTF database to produce a filtered instrument sound that sounds as if it is coming from either the left, right, or forward. After each instrument is filtered, the left channels of all instruments are summed and the right channels of all instruments are summed, before being outputted by the audio bus master.</p>
								</div>
							</div>
						</section>
						<section>
							<div class="content">
								<div class="inner">
									<h3>User Interface</h3>
									<p>The user interacts with the system through a combination of the command line and VGA monitor. The command line is obtained by opening a SSH connection with the HPS and is used to start the program as well as to allow the user to move the instruments around a virtual room. The VGA monitor displays the virtual room and the current locations of the instruments so the user can visually place where the sounds are coming from, which adds to the overall illusion.</p>
								</div>
							</div>

						</section>
						<div class="content">
								<div class="inner">
						<div class="box alt">
							<div class="row gtr-uniform">
							<div class="col-12"><span class="image fit"><img src="images/System.jpg" alt="" /></span></div>
							</div>
						</div>
									</div>
							</div>
						
					</section>
				
				
				<!-- Design -->
					<section id="hdesign" class="wrapper style3 fade-up">
							<div class="inner">
							<h2>Hardware Design</h2>
							<h3>Instrument Module</h3>
							<p>An instrument module is used to generate a note. It takes eight inputs: instr, type, duration, string_len, clk, GlobalReset, reset, and FIR_done. The instr input selects the type of instrument. For example, this input can select whether this module outputs a flute, clarinet, oboe, cello, or marimba sound. The type input determines whether the module should output a plucked sound or a sustained sound. The duration input determines the length of a sound, if the sound is sustained. The string_len input determines the pitch (i.e. frequency) of the sound.  </p>
							<p>To generate the sound samples, the Karplus-Strong Algorithm was used. This algorithm takes a drive function and uses feedback to create a note, as shown in Figure #. The difference between the algorithm for a plucked sound and a sustained sound is the repetition of the drive function. If the drive function is only input once into the system, the output will be a plucked sound. If the drive function is input periodically, the output will be a sustained sound.</p>
							</div>
						

						<div class="box alt">
							<div class="row gtr-uniform">
							<div class="col-6"><span class="image fit"><img src="images/Instrument.png" alt="" /></span></div>
							<div class="col-6"><span class="image fit"><img src="images/Instrument.png" alt="" /></span></div>
							</div>
						</div>

							<div class="inner">
							<p>The pitch of the output sound is determined by the length of the drive function, which is also the length of the delay line. Because the audio CODEC has an output rate of 48,000 samples/second, the frequency of the output note is (48,000 samples/second)/(N samples) = 48,000/N Hz, where N is the length of a single period of the drive function.</p>
							<p>The Karplus-Strong feedback loop uses a low-pass filter (LPF) and contains loss. The LPF is a simple average of the last two samples. The loss is on the order of 0.7%. This loss was chosen because it allows the algorithm to generate a tone without overflow. Without any loss, the loop would build up due to positive feedback and overflow. With too much loss, the drive function would completely dominate and the output will not converge to a sinusoidal-like wave.</p>
							
							<p>Different instruments, or tambers, are produced by altering the drive function. The different drive functions are shown in Figure #. Interestingly, we found that a plucked clarinet sounded like a plucked cello, and a plucked flute sounded like a marimba. Thus, the instr input selects the clarinet and flute drive functions when a cello or marimba sound is wanted, respectively. </p>
							<p>To save register memory, the selected instrument’s drive function and delay-line values are stored in M10K memory. In our first implementation of this project, we only used register (ALM) memory. We quickly discovered that our project would not fit in ALM memory due to the use of large register arrays in the instrument and the FIR modules. Two 20x512 M10K blocks were used (per instrument module) to decrease our ALM memory usage. This ultimately allowed our project to fit on the SoC.</p>
							<p>The instrument module’s finite state machine (FSM) is shown in Figure #. Upon a user-input reset or a change of instruments, the instrument module enters its GlobalReset state. In that state, the selected instrument’s drive function is written to M10K over the course of 512 cycles. In each of the 512 cycles, a new drive sample value is written to M10K. </p>	
							<p>In the subsequent states, the drive function and previous-delay-line values are read from M10K. During the first iteration of the loop, the drive function is the output, so a read from the previous-delay-line M10K block is not necessary for the output calculation. Once the output is calculated, it gets stored in the previous-delay-line M10K block and the module returns to the Read State.</p>
						</div>
						
						<div class="box alt">
							<div class="row gtr-uniform">
							<div class="col-12"><span class="image fit"><img src="images/FSM.png" alt="" /></span></div>
							</div>
						</div>
						
						<div class="inner">
							<p>Every time there is a GlobalReset, 512 values are written to the drive-function M10K block. To achieve different output pitches, the pointer that reads from the M10K blocks circulates back to the string_len value. Therefore, higher-frequency notes will only use a small part of its drive function; lower-frequency notes will read more of the drive function.</p>
							<p>The duration input is used if a note is sustained (i.e. type is sustained). The instrument module will continue to feed the drive function into the feedback loop for the duration number of samples. Once the drive function stops getting fed into the feedback loop, the output naturally decays (similar to a pluck’s decay).</p>
							<p>The duration input is also used to amplitude-modulate the drive function as it gets fed into the loop. This was originally done to achieve a string instrument’s bowed sound, however, this feature was kept because it adds a smoothness to the start of a wind instrument’s sustained notes.</p>
						</div>
						
						<div class="inner">
							<h3>Score Module</h3>
							<p>An instrument module is used to generate a note. It takes eight inputs: instr, type, duration, string_len, clk, GlobalReset, reset, and FIR_done. The instr input selects the type of instrument. For example, this input can select whether this module outputs a flute, clarinet, oboe, cello, or marimba sound. The type input determines whether the module should output a plucked sound or a sustained sound. The duration input determines the length of a sound, if the sound is sustained. The string_len input determines the pitch (i.e. frequency) of the sound.  </p>
							<p>To generate the sound samples, the Karplus-Strong Algorithm was used. This algorithm takes a drive function and uses feedback to create a note, as shown in Figure #. The difference between the algorithm for a plucked sound and a sustained sound is the repetition of the drive function. If the drive function is only input once into the system, the output will be a plucked sound. If the drive function is input periodically, the output will be a sustained sound.</p>	
						</div>
						<div class="box alt">
							<div class="row gtr-uniform">
							<div class="col-12"><span class="image fit"><img src="images/bolero.png" alt="" /></span></div>
							</div>
						</div>
						
						<div class="inner">
							<h3>FIR_filter Module</h3>
							<p>The FIR filters are a collection of three different modules, each corresponding to a different direction. Based on the results of a large mux, different instruments would be fed into different filter modules in order to achieve the effect of spatial sound.</p>
							<p>At reset, the 400 HRIR (200 left and 200 right) coefficients are stored in two 200 entry arrays of 27 bit registers which is used for the remainder of the program. This process takes 200 cycles because we could only fill one index of each array every cycle. In addition to these HRIR arrays, there is another array x that saves the previous 200 sample values within the filter module, but is initialized to be full of zeros. After these first 200 cycles are past, the module is ready to begin filtering samples. Once the sample is synthesized and reaches the filter module, it is saved in the first index of the array x.  Every cycle, a counter is incremented and which multiplies the value of the x array with its corresponding HRIR coefficient. The multiply is performed by two signed_27_mult modules in order to perform the left and right channels in parallel.</p>
							<p>The product of every sample-coefficient pair is accumulated so that after 200 cycles, the sample is filtered and can be outputted. The filter module looks for the audio_done flag, signalling the audio bus master is ready to accept a sample before then putting its done flag high, signaling that the bus master can go ahead and read the output from the module. After this relay between the filter and bus master, the filter saves the next sample to the 0 index of the x array and shifts all previous values by one index to the right. This effectively makes x a running array of the previous 200 input samples.</p>
						</div>
						<div class="box alt">
							<div class="row gtr-uniform">
							<div class="col-12"><span class="image fit"><img src="images/Cycles.jpg" alt="" /></span></div>
							</div>
						</div>
						
					</section>
				
				<!-- One -->
					<section id="one" class="wrapper style2 spotlights">
						<section>
							<a href="#" class="image"><img src="images/pic01.jpg" alt="" data-position="center center" /></a>
							<div class="content">
								<div class="inner">
									<h2>Sed ipsum dolor</h2>
									<p>Phasellus convallis elit id ullamcorper pulvinar. Duis aliquam turpis mauris, eu ultricies erat malesuada quis. Aliquam dapibus.</p>
									<ul class="actions">
										<li><a href="generic.html" class="button">Learn more</a></li>
									</ul>
								</div>
							</div>
						</section>
						<section>
							<a href="#" class="image"><img src="images/pic02.jpg" alt="" data-position="top center" /></a>
							<div class="content">
								<div class="inner">
									<h2>Feugiat consequat</h2>
									<p>Phasellus convallis elit id ullamcorper pulvinar. Duis aliquam turpis mauris, eu ultricies erat malesuada quis. Aliquam dapibus.</p>
									<ul class="actions">
										<li><a href="generic.html" class="button">Learn more</a></li>
									</ul>
								</div>
							</div>
						</section>
						<section>
							<a href="#" class="image"><img src="images/pic03.jpg" alt="" data-position="25% 25%" /></a>
							<div class="content">
								<div class="inner">
									<h2>Ultricies aliquam</h2>
									<p>Phasellus convallis elit id ullamcorper pulvinar. Duis aliquam turpis mauris, eu ultricies erat malesuada quis. Aliquam dapibus.</p>
									<ul class="actions">
										<li><a href="generic.html" class="button">Learn more</a></li>
									</ul>
								</div>
							</div>
						</section>
					</section>

				<!-- Two -->
					<section id="two" class="wrapper style3 fade-up">
						<div class="inner">
							<h2>What we do</h2>
							<p>Phasellus convallis elit id ullamcorper pulvinar. Duis aliquam turpis mauris, eu ultricies erat malesuada quis. Aliquam dapibus, lacus eget hendrerit bibendum, urna est aliquam sem, sit amet imperdiet est velit quis lorem.</p>
							<div class="features">
								<section>
									<span class="icon solid major fa-code"></span>
									<h3>Lorem ipsum amet</h3>
									<p>Phasellus convallis elit id ullam corper amet et pulvinar. Duis aliquam turpis mauris, sed ultricies erat dapibus.</p>
								</section>
								<section>
									<span class="icon solid major fa-lock"></span>
									<h3>Aliquam sed nullam</h3>
									<p>Phasellus convallis elit id ullam corper amet et pulvinar. Duis aliquam turpis mauris, sed ultricies erat dapibus.</p>
								</section>
								<section>
									<span class="icon solid major fa-cog"></span>
									<h3>Sed erat ullam corper</h3>
									<p>Phasellus convallis elit id ullam corper amet et pulvinar. Duis aliquam turpis mauris, sed ultricies erat dapibus.</p>
								</section>
								<section>
									<span class="icon solid major fa-desktop"></span>
									<h3>Veroeros quis lorem</h3>
									<p>Phasellus convallis elit id ullam corper amet et pulvinar. Duis aliquam turpis mauris, sed ultricies erat dapibus.</p>
								</section>
								<section>
									<span class="icon solid major fa-link"></span>
									<h3>Urna quis bibendum</h3>
									<p>Phasellus convallis elit id ullam corper amet et pulvinar. Duis aliquam turpis mauris, sed ultricies erat dapibus.</p>
								</section>
								<section>
									<span class="icon major fa-gem"></span>
									<h3>Aliquam urna dapibus</h3>
									<p>Phasellus convallis elit id ullam corper amet et pulvinar. Duis aliquam turpis mauris, sed ultricies erat dapibus.</p>
								</section>
							</div>
							<ul class="actions">
								<li><a href="generic.html" class="button">Learn more</a></li>
							</ul>
						</div>
					</section>

				<!-- Three -->
					<section id="three" class="wrapper style1 fade-up">
						<div class="inner">
							<h2>Get in touch</h2>
							<p>Phasellus convallis elit id ullamcorper pulvinar. Duis aliquam turpis mauris, eu ultricies erat malesuada quis. Aliquam dapibus, lacus eget hendrerit bibendum, urna est aliquam sem, sit amet imperdiet est velit quis lorem.</p>
							<div class="split style1">
								<section>
									<form method="post" action="#">
										<div class="fields">
											<div class="field half">
												<label for="name">Name</label>
												<input type="text" name="name" id="name" />
											</div>
											<div class="field half">
												<label for="email">Email</label>
												<input type="text" name="email" id="email" />
											</div>
											<div class="field">
												<label for="message">Message</label>
												<textarea name="message" id="message" rows="5"></textarea>
											</div>
										</div>
										<ul class="actions">
											<li><a href="" class="button submit">Send Message</a></li>
										</ul>
									</form>
								</section>
								<section>
									<ul class="contact">
										<li>
											<h3>Address</h3>
											<span>12345 Somewhere Road #654<br />
											Nashville, TN 00000-0000<br />
											USA</span>
										</li>
										<li>
											<h3>Email</h3>
											<a href="#">user@untitled.tld</a>
										</li>
										<li>
											<h3>Phone</h3>
											<span>(000) 000-0000</span>
										</li>
										<li>
											<h3>Social</h3>
											<ul class="icons">
												<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
												<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
												<li><a href="#" class="icon brands fa-github"><span class="label">GitHub</span></a></li>
												<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
												<li><a href="#" class="icon brands fa-linkedin-in"><span class="label">LinkedIn</span></a></li>
											</ul>
										</li>
									</ul>
								</section>
							</div>
						</div>
					</section>

			</div>

		<!-- Footer -->
			<footer id="footer" class="wrapper style1-alt">
				<div class="inner">
					<ul class="menu">
						<li>&copy; Untitled. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
					</ul>
				</div>
			</footer>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>
